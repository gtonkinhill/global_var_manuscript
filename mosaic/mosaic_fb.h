#if !defined MOSAIC_H
#define MOSAIC_H


#include<stdlib.h>
#include<stdio.h>
#include<math.h>
#include<string.h>
#include<time.h>

#define NSTATE_AA 25
#define NSTATE_NT 5
#define SMALL -1e6
#define VERYSMALL -9999999.0


long *idum;

		/*Amino acids - IUPAC convention

	    Abbreviation    Amino acid name
        ------------    ---------------

		???		? 0		 Missing data
        Ala     A 1      Alanine
        Arg     R 2      Arginine
        Asn     N 3      Asparagine
        Asp     D 4      Aspartic acid (Aspartate)
        Cys     C 5      Cysteine
        Gln     Q 6      Glutamine
        Glu     E 7      Glutamic acid (Glutamate)
        Gly     G 8      Glycine
        His     H 9      Histidine
        Ile     I 10     Isoleucine
        Leu     L 11     Leucine
        Lys     K 12     Lysine
        Met     M 13     Methionine
        Phe     F 14     Phenylalanine
        Pro     P 15     Proline
        Ser     S 16     Serine
        Thr     T 17     Threonine
        Trp     W 18     Tryptophan
        Tyr     Y 19     Tyrosine
        Val     V 20     Valine
        Asx     B 21     Aspartic acid or Asparagine
        Glx     Z 22     Glutamine or Glutamic acid.
        Xaa     X 23     Any amino acid.
        TERM    * 24     termination codon

*/

/*For amino acids*/

/*Initial iteration*/

double emiss_gap_aa[NSTATE_AA]={-3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825};


double emiss_match_aa[NSTATE_AA][NSTATE_AA]=\
{{-3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825},\
{-3.218875825, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031}};


double char_frequencies[NSTATE_AA]={2.55575050252e-7,0.0458355962374,0.0719062959636,0.068612700291,0.0976207240697,0.0297558363757,0.0424372147942,0.0599525397132,0.0720818760231,0.0134851619515,0.049724170627,0.0591395554783,0.107938288848,0.00386480590992,0.0354577157469,0.0294207774849,0.0300244457536,0.0595471976835,0.0244915014906,0.0612035795842,0.0375048718994,2.55575050252e-7,2.55575050252e-7,5.11150100505e-7,2.55575050252e-7};

/*
For nucleotides

	NUC		NUM
	---		---
	?		0
	T		1
	C		2
	A		3
	G		4
*/


double emiss_gap_nt[NSTATE_NT]={-2.995732274, -1.437587656, -1.437587656, -1.437587656, -1.437587656};

double emiss_match_nt[NSTATE_NT][NSTATE_NT]=\
{{-2.995732274, -2.995732274, -2.995732274, -2.995732274, -2.995732274},\
{-1.437587656, -0.105360516, -4.094344562, -4.094344562, -4.094344562},\
{-1.437587656, -4.094344562, -0.105360516, -4.094344562, -4.094344562},\
{-1.437587656, -4.094344562, -4.094344562, -0.105360516, -4.094344562},\
{-1.437587656, -4.094344562, -4.094344562, -4.094344562, -0.105360516}};


/*Structures*/

/*Stores all matrices - don't want to allocate them all the time*/
struct matrices {

	double ***m1_m;
	double ***m1_i;
	double ***m1_d;
	double ***m2_m;
	double ***m2_i;
	double ***m2_d;

	int *who_copy;

	int *maxpath_copy;
	int *maxpath_state;
	int *maxpath_pos;
	double *ppsum_match;
	double **ppsum_state;

	int maxl;
	double llk;

	double tb_divisor;

};



/*Function declarations*/

struct pars * get_pars(int argc, char *argv[]);
void kalign_fb(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);
struct data * add_null_term(struct data *my_data);
void classify_sequences(struct pars *my_pars, struct data *my_data);
struct matrices * allocate_matrices(struct data *my_data, struct pars *my_pars);
void deallocate_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices);
void print_max_acc_alignment(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);
void print_posterior_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);
void print_forward_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target, FILE *ofp);
void print_backward_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target, FILE *ofp);
void kalign_vt(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);

#endif


