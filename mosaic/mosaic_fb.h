#if !defined MOSAIC_H
#define MOSAIC_H


#include<stdlib.h>
#include<stdio.h>
#include<math.h>
#include<string.h>
#include<time.h>

#define NSTATE_AA 25
#define NSTATE_NT 5
#define SMALL -1e6
#define VERYSMALL -9999999.0


long *idum;

		/*Amino acids - IUPAC convention

	    Abbreviation    Amino acid name
        ------------    ---------------

		???		? 0		 Missing data
        Ala     A 1      Alanine
        Arg     R 2      Arginine
        Asn     N 3      Asparagine
        Asp     D 4      Aspartic acid (Aspartate)
        Cys     C 5      Cysteine
        Gln     Q 6      Glutamine
        Glu     E 7      Glutamic acid (Glutamate)
        Gly     G 8      Glycine
        His     H 9      Histidine
        Ile     I 10     Isoleucine
        Leu     L 11     Leucine
        Lys     K 12     Lysine
        Met     M 13     Methionine
        Phe     F 14     Phenylalanine
        Pro     P 15     Proline
        Ser     S 16     Serine
        Thr     T 17     Threonine
        Trp     W 18     Tryptophan
        Tyr     Y 19     Tyrosine
        Val     V 20     Valine
        Asx     B 21     Aspartic acid or Asparagine
        Glx     Z 22     Glutamine or Glutamic acid.
        Xaa     X 23     Any amino acid.
        TERM    * 24     termination codon

*/

/*For amino acids*/

// double emiss_gap_aa[NSTATE_AA]={-3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825};

// baumwelch estimate (OLD with contam)
//double emiss_gap_aa[NSTATE_AA]={-15.17975,-2.878188,-2.902578,-2.446253,-2.068217,-5.197468,-3.334687,-2.818462,-2.24965,-4.697258,-3.407287,-3.248857,-1.881553,-4.715197,-4.560469,-3.775137,-2.762511,-2.562777,-6.161233,-3.913652,-3.458058,-15.17975,-15.17975,-15.17975,-15.17975};

// baumwelch estimate
double emiss_gap_aa[NSTATE_AA]={-15.179750,  -2.785442,  -2.957743,  -2.486455,  -2.159094,  -5.118128,  -3.314402,  -2.857823, -2.236218,  -4.690135,  -3.369137,  -3.185917,  -1.834366,  -4.332568,  -4.636443,  -3.854483, -2.745970,  -2.544004,  -6.123803,  -4.185349,  -3.432210, -15.179750, -15.179750, -15.179750,-15.179750};

/*
double emiss_match_aa[NSTATE_AA][NSTATE_AA]=\
{{-3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825, -3.218875825},\
{-3.218875825, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031, -5.032614201},\
{-3.218875825, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -5.032614201, -0.210721031}};
*/

// baumwelch estimate (Old with contam)
// double emiss_match_aa[NSTATE_AA][NSTATE_AA]=\
//   {{-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682},\
//   {-6.9582070724782,-0.159222208719143,-5.49220580971343,-5.05410948943164,-4.46210959314741,-6.61575778246272,-4.92748536193428,-4.17617436535353,-4.34315238529179,-5.3790505623811,-5.3597569451479,-4.82855151550986,-4.59961091878283,-6.69692750339054,-6.75705364656861,-4.85785866464357,-4.55788139794489,-3.96482294702032,-6.9194739219363,-6.10329061229021,-4.32369005432834,-6.9582070724782,-6.9582070724782,-6.9582070724782,-6.9582070724782},\
//   {-6.97753382358999,-6.13933795144832,-0.105053379388152,-5.35904414361789,-5.66861287684685,-6.79112811705036,-4.89482051153466,-5.27203542315409,-4.92681553100737,-4.66417701656806,-5.90341669041944,-5.30584528296877,-3.6876978021259,-6.52201645105794,-6.71399899456246,-5.88248423953979,-5.4738496701828,-5.09822103165486,-6.69700789800442,-5.83348656370348,-6.39621955714684,-6.97753382358999,-6.97753382358999,-6.97753382358999,-6.97753382358999},\
//   {-6.96258152126584,-5.29908806315022,-5.3466995141308,-0.201984463107458,-3.42426427959382,-6.83543501740243,-5.2425519886421,-4.4480258214805,-4.07236529463397,-5.03322645462599,-5.35778118781878,-6.18088362902049,-3.19587284310316,-6.50522821486124,-6.20673954004342,-5.6236740153245,-4.02482542944548,-4.51499629960742,-6.82144037753014,-4.92481815444684,-6.11483103905906,-6.96258152126584,-6.96258152126584,-6.96258152126584,-6.96258152126584},\
//   {-6.97144058066824,-5.0268025365084,-5.92832049814333,-3.77502986072053,-0.138338393246053,-6.87591727213335,-5.23842688197494,-3.86644249941082,-4.15201050201723,-5.49859899871895,-6.08632457813191,-6.42922535001694,-4.34003643248177,-6.51561159499043,-6.72007286594606,-5.71592565860286,-4.99037663832989,-4.69192134677183,-6.88325755738172,-5.73929023841516,-6.15196174177189,-6.97144058066824,-6.97144058066824,-6.97144058066824,-6.97144058066824},\
//   {-6.9864189701655,-6.36107920232213,-6.14564109395715,-6.68006129296904,-6.83967535817122,-0.0335721677339434,-6.79970757489868,-6.92373143350496,-6.36612810606311,-6.9342011289968,-6.50636432891568,-6.44553103705504,-6.82084310699252,-6.89045498190376,-6.23086372094139,-6.15702258657094,-6.33325007855264,-6.63141145120003,-6.6653967087438,-6.25033810837767,-6.30286490618004,-6.9864189701655,-6.9864189701655,-6.9864189701655,-6.9864189701655},\
//   {-6.96782340544818,-5.20012004829438,-4.26514315941588,-4.52547637007897,-4.50591285939067,-6.67303855131523,-0.224495127321966,-3.56412481828038,-5.04883532791148,-5.20672277338696,-5.19277746690872,-5.26503694131316,-2.63621856159553,-5.95640593129284,-6.54801962258007,-4.91206186137248,-5.31035918387074,-4.90568721364308,-6.49042707833138,-5.83130299498396,-5.83719918809647,-6.96782340544818,-6.96782340544818,-6.96782340544818,-6.96782340544818},\
//   {-6.96798305453262,-4.29231385961259,-5.10674699507293,-4.30168238399239,-3.33324620260047,-6.932611604981,-3.87495118421291,-0.223117126662023,-4.01796419522916,-5.17112094788139,-6.15252566612565,-5.84786644376321,-3.11451688567072,-6.59946203262624,-6.84210794774628,-5.44107975591543,-4.91538415694696,-4.53524303436338,-6.8102202531456,-6.07778520357451,-5.71688286188873,-6.96798305453262,-6.96798305453262,-6.96798305453262,-6.96798305453262},\
//   {-6.9681945927931,-4.48456795310105,-4.76646538397577,-4.14922649939026,-3.95945963475257,-6.53498460371166,-5.47677345023939,-4.22598650347367,-0.146899410363026,-5.72148226247011,-6.14040453788923,-5.87483678517581,-4.14641931787624,-6.62641734408975,-6.47623168655423,-5.31658222535448,-4.42268935839375,-5.02122270344587,-6.69814191195183,-6.26658488751445,-5.6660956425995,-6.9681945927931,-6.9681945927931,-6.9681945927931,-6.9681945927931},\
//   {-6.95678802255945,-4.27488495631769,-3.35055327291756,-3.69379355832523,-4.14024510551488,-6.681536511151,-4.2146867947031,-4.20093922239474,-5.09567865899119,-0.273080447672442,-6.15603268351796,-5.09806589983811,-4.02673269381208,-6.14477896007902,-6.65094492019744,-4.65843916486743,-4.47434813518241,-5.28839678910631,-6.75550645644447,-3.04665831698374,-5.74853410489513,-6.95678802255945,-6.95678802255945,-6.95678802255945,-6.95678802255945},\
//   {-6.97533738030538,-5.58245799692328,-5.47840037840125,-5.41240368958525,-5.97868548474822,-6.86747638248302,-5.43135640131205,-6.36249819341109,-6.09811373298584,-6.45429292260517,-0.106654526108392,-4.44410526457353,-5.33098414681187,-5.14448854599267,-5.88575304268532,-6.2735081563418,-5.8205231276871,-4.91430640046873,-6.96205203238944,-5.71656275902038,-3.54162114368631,-6.97533738030538,-6.97533738030538,-6.97533738030538,-6.97533738030538},\
//   {-6.97458971716936,-5.03982206553124,-5.16431978258427,-6.53151297955087,-6.42535994441168,-6.90965703627173,-5.85445416302403,-5.86800869318106,-6.10793089990593,-6.21081525018349,-4.539691431961,-0.0768158236734331,-5.97973357423228,-6.09778102515562,-4.93398675179843,-5.67309804252521,-5.6251699700764,-5.98633766181618,-6.66120769988891,-5.81343547339938,-5.02170883056487,-6.97458971716936,-6.97458971716936,-6.97458971716936,-6.97458971716936},\
//   {-6.97672994348561,-5.05196488009688,-4.13362676728749,-3.6040417552785,-4.33476109220671,-6.89750761253053,-3.57585582258071,-3.55033529466582,-4.45478194084988,-5.75894077465145,-5.56290775777636,-6.36540156881179,-0.196958896971282,-6.1504364822144,-6.85076041746227,-5.54014656881767,-4.70787831584806,-4.47283540944167,-6.88947306530406,-5.97758101599933,-6.11573573765751,-6.97672994348561,-6.97672994348561,-6.97672994348561,-6.97672994348561},\
//   {-6.91075968800243,-6.07769794490591,-4.41408289321424,-5.12349039151634,-5.31871387021325,-6.09513749844602,-4.34824365670631,-4.84794890360411,-5.62536406252209,-6.282244647138,-3.05404690272773,-3.58712633766373,-4.15410720556251,-0.219208453582829,-5.74103263043635,-6.68833856407556,-6.21066577918956,-3.75720102233677,-6.88023729294539,-5.00461087679019,-4.60403073529466,-6.91075968800243,-6.91075968800243,-6.91075968800243,-6.91075968800243},\
//   {-6.98059487515909,-6.63334848373038,-6.6998472503107,-6.23749302095965,-6.84882626145285,-6.44963452164817,-6.47688241693944,-6.42523659143168,-6.62589014185192,-6.33621097018144,-5.80191919522471,-4.46078421853717,-6.79496250150701,-6.59389394474705,-0.113657109215813,-6.72061208190897,-5.53879788751552,-6.67715961414289,-6.83158163475929,-2.76314787805813,-6.34414751977718,-6.98059487515909,-6.98059487515909,-6.98059487515909,-6.98059487515909},\
//   {-6.98247942517789,-4.31978509821029,-5.01956564591724,-4.96838132619924,-4.99176016682727,-6.27949394632903,-4.6494152973095,-4.92697512412609,-4.53536491174395,-5.52892681397334,-6.13542790054757,-5.33237125387274,-4.75361279134819,-6.80668957024715,-6.53791794851694,-0.134199072215324,-4.65765426204497,-4.31589124017641,-6.92561439728327,-6.44632009915738,-4.57377871375685,-6.98247942517789,-6.98247942517789,-6.98247942517789,-6.98247942517789},\
//   {-6.93220122188696,-4.17253703180891,-4.54877049913887,-3.4332760071258,-4.09708185642599,-6.53988775128919,-5.41307702585362,-4.47102790471905,-3.60966309968638,-5.26289185932974,-5.03439233155235,-5.1125845166319,-3.67601213840701,-6.14704246225967,-5.13475353268257,-4.50770279276178,-0.248007422395539,-3.78411318680601,-6.49959335932613,-5.19988434376281,-5.61713196293297,-6.93220122188696,-6.93220122188696,-6.93220122188696,-6.93220122188696},\
//   {-6.97448241103275,-4.18521018172937,-4.9793178795902,-4.5267375552863,-4.42469989255751,-6.92068810439394,-4.89723473276862,-4.38348324567178,-4.697164418134,-6.13256693808588,-4.99901264426837,-6.21788802297223,-3.86366343652623,-5.65562062954908,-6.69232092073788,-5.20601124576391,-4.36951280460559,-0.153257495100078,-6.82963704971808,-5.61821919630666,-5.81793104634701,-6.97448241103275,-6.97448241103275,-6.97448241103275,-6.97448241103275},\
//   {-6.99522040476301,-6.70816608728906,-6.01577683168986,-6.84098397534788,-6.76673236126984,-6.62902476042798,-6.02588947412259,-6.62974392622668,-5.99010457106995,-6.92383294919442,-6.60347333487458,-6.62891125519716,-6.71862273025923,-6.91045803055605,-6.53464030109123,-6.78886084904132,-6.41975735615576,-6.79121656273378,-0.0322995892324644,-6.68057896655415,-6.63990518428367,-6.99522040476301,-6.99522040476301,-6.99522040476301,-6.99522040476301},\
//   {-6.98474372051009,-6.31694481078983,-5.68863713732957,-4.97925958118083,-5.27980909499212,-6.37430687717969,-6.05276504768441,-5.92760690812646,-6.34320820971633,-4.57334151582336,-5.76512550489707,-5.87758184353637,-5.48838827680187,-6.77265576556034,-3.1199216901489,-6.76734077526674,-5.67525272854205,-5.69349496678789,-6.85090186738917,-0.112653113151788,-6.46210778124096,-6.98474372051009,-6.98474372051009,-6.98474372051009,-6.98474372051009},\
//   {-6.9843667813539,-4.48529196981728,-6.11616686311008,-5.8843519679117,-5.41060219727861,-6.66304634975329,-5.81608408799328,-5.49863630180357,-5.13966580413932,-6.66767635096164,-3.21494894673023,-4.67013052924474,-5.38215600146391,-6.13137089985206,-6.42255560285504,-4.82233206562467,-5.80355901202005,-5.62561422963383,-6.87282299244203,-6.56814551366992,-0.123158750560477,-6.9843667813539,-6.9843667813539,-6.9843667813539,-6.9843667813539},\
//   {-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682},\
//   {-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682},\
//   {-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682},\
//   {-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682,-3.2188758248682}};


// baumwelch estimate
double emiss_match_aa[NSTATE_AA][NSTATE_AA]=\
  {{-3.218876, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.218876, -3.21887582, -3.218876, -3.2188758, -3.218876, -3.218876, -3.218876,  -3.218876},\
{-6.958113, -0.1579558, -5.2753386, -4.8247088, -4.5272422, -6.44206617, -4.8580426, -4.4257321, -4.1189512, -5.7512582, -5.7968482, -4.88728228, -4.6342898, -6.7647134, -6.8743202, -4.8651503, -4.6804683, -3.877713, -6.94799840, -6.241579, -4.3000900, -6.958113, -6.958113, -6.958113,  -6.958113},\
{-6.981281, -6.1448219, -0.1047963, -5.5860873, -5.7505936, -6.94062188, -4.8910898, -5.1753910, -4.7880909, -4.7609267, -5.7585545, -5.09443266, -3.6983857, -6.6240802, -6.6938085, -5.7539175, -5.7281766, -5.224880, -6.59343028, -5.727596, -6.3739285, -6.981281, -6.981281, -6.981281,  -6.981281},\
{-6.970695, -5.3459917, -5.2448400, -0.2086488, -3.3993061, -6.78534123, -5.2236225, -4.3906506, -4.0370386, -5.0021880, -5.3017457, -6.03256458, -3.1523369, -6.6887092, -6.2298348, -5.5909899, -3.9739873, -4.547457, -6.95019918, -4.890721, -6.2370244, -6.970695, -6.970695, -6.970695,  -6.970695},\
{-6.975557, -4.9266606, -6.0026366, -3.8466815, -0.1375405, -6.89439919, -5.1830845, -3.9516177, -4.0969935, -5.4698428, -6.1185394, -6.59027049, -4.3276719, -6.5089779, -6.7330541, -5.6211573, -5.0223693, -4.664553, -6.97258892, -5.584104, -6.0785232, -6.975557, -6.975557, -6.975557,  -6.975557},\
{-6.994402, -6.3031956, -6.4932928, -6.7575161, -6.8206597, -0.03271596, -6.8138594, -6.9612724, -6.4208800, -6.9514741, -6.5909991, -6.65475003, -6.7714768, -6.8004957, -6.2498890, -5.9211916, -6.4446495, -6.647101, -6.99428104, -6.160908, -6.2517900, -6.994402, -6.994402, -6.994402,  -6.994402},\
{-6.993554, -5.2781868, -4.0984250, -4.5216860, -4.3922643, -6.71429109, -0.2346769, -3.4197641, -5.0425032, -5.1283484, -5.2715444, -5.04188397, -2.6301208, -6.1312364, -6.5139118, -5.2042390, -5.4596593, -4.777963, -6.67488022, -5.580001, -5.8767863, -6.993554, -6.993554, -6.993554,  -6.993554},\
{-6.976748, -4.2847227, -5.0606489, -4.1880403, -3.3669443, -6.96185976, -3.7669998, -0.2258616, -3.9442423, -5.2457673, -6.2400401, -5.78390874, -3.1371860, -6.4627136, -6.9617425, -5.3094235, -5.1440717, -4.494037, -6.93227591, -6.239015, -5.7477694, -6.976748, -6.976748, -6.976748,  -6.976748},\
{-6.967740, -4.4360357, -4.9186779, -4.0908759, -3.8498088, -6.64138063, -5.5706790, -4.1567791, -0.1500588, -5.7040478, -6.1982414, -6.27047190, -4.1057143, -6.5932677, -6.5431108, -5.3262127, -4.3942328, -5.038982, -6.46677870, -6.386780, -5.7355470, -6.967740, -6.967740, -6.967740,  -6.967740},\
{-6.921742, -4.3244037, -3.4408258, -3.9348995, -4.7979059, -6.91668402, -4.4441764, -4.2230269, -5.3683108, -0.2520717, -6.0887100, -5.51129070, -3.9067758, -6.5124903, -6.8884976, -4.7209678, -4.4718056, -4.999432, -6.90819993, -2.951050, -5.6624487, -6.921742, -6.921742, -6.921742,  -6.921742},\
{-6.990533, -6.1204595, -5.4294890, -5.3782020, -5.9471281, -6.91243220, -5.3490721, -6.4925592, -6.2717070, -6.3244223, -0.1075665, -4.30997408, -5.5405581, -5.4225958, -5.8962749, -6.1675648, -5.7133272, -5.007456, -6.98176003, -5.627222, -3.4581516, -6.990533, -6.990533, -6.990533,  -6.990533},\
{-6.984516, -4.6975654, -5.0134222, -6.6354404, -6.4403937, -6.93181998, -5.8023877, -5.8738590, -6.0430382, -5.9797992, -4.5921659, -0.08012427, -6.0789606, -6.2183369, -5.4543992, -5.3511085, -5.5182712, -5.788941, -6.75455710, -5.694294, -4.9701330, -6.984516, -6.984516, -6.984516,  -6.984516},\
{-6.976034, -5.2061843, -4.1248866, -3.5666032, -4.4456154, -6.90842250, -3.5802367, -3.4862002, -4.4480053, -5.6275319, -5.6750658, -6.37353904, -0.1991492, -6.0400484, -6.8251521, -5.4697125, -4.6523320, -4.493977, -6.92524093, -5.860086, -6.1551348, -6.976034, -6.976034, -6.976034,  -6.976034},\
{-6.900007, -5.7523424, -4.2979958, -5.1067606, -6.2671885, -6.89956645, -4.1252229, -5.1044880, -5.5322689, -6.3335791, -3.1815825, -3.76266931, -4.0666384, -0.1992348, -6.6892444, -6.6763788, -6.7009216, -3.887563, -6.89967666, -4.620092, -5.3097826, -6.900007, -6.900007, -6.900007,  -6.900007},\
{-6.991137, -6.5116672, -6.8166964, -6.2769563, -6.8457198, -6.83771100, -6.6400207, -6.5452749, -6.8005963, -6.3228740, -6.2001026, -4.34289983, -6.7678000, -6.8445717, -0.1166577, -6.8234140, -5.2681977, -6.911652, -6.81629076, -2.723766, -6.1859665, -6.991137, -6.991137, -6.991137,  -6.991137},\
{-6.981881, -4.3806238, -5.1761201, -4.8990201, -4.7962641, -6.27589333, -4.6999578, -4.6045488, -4.4794686, -5.3755591, -6.1978063, -5.32534671, -4.6395093, -6.8530573, -6.8224961, -0.1366764, -4.7157425, -4.296461, -6.87787357, -6.378959, -4.7954977, -6.981881, -6.981881, -6.981881,  -6.981881},\
{-6.942692, -4.1094782, -4.8679498, -3.3425257, -4.0004290, -6.33057994, -5.7262323, -4.4666938, -3.6610954, -5.1659252, -5.1699043, -4.94617457, -3.6151703, -6.3113022, -5.2428193, -4.6608705, -0.2451396, -3.876543, -6.23198001, -5.175176, -6.0890525, -6.942692, -6.942692, -6.942692,  -6.942692},\
{-6.968213, -4.2911053, -5.1741542, -4.5730144, -4.3598124, -6.93718353, -5.0084372, -4.4459272, -4.8480625, -5.9850402, -5.0557716, -6.03743812, -3.7974247, -5.4710313, -6.6886192, -5.1461872, -4.5455599, -0.149720, -6.95858029, -5.338861, -5.7078903, -6.968213, -6.968213, -6.968213,  -6.968213},\
{-6.996949, -6.9866766, -6.0626486, -6.8870799, -6.9902902, -6.87142168, -5.9550238, -6.9312497, -5.6605298, -6.9956138, -6.4265628, -6.87905818, -6.5678745, -6.8267883, -6.8723865, -6.9524024, -6.7799469, -6.922529, -0.03091182, -6.510470, -6.9798465, -6.996949, -6.996949, -6.996949,  -6.996949},\
{-6.998531, -6.1236505, -5.7531825, -4.9013472, -5.1298503, -6.16761816, -6.0152106, -6.1828400, -6.6417222, -4.5604090, -5.5533813, -6.21266521, -5.6772700, -6.7819058, -3.1284205, -6.6913899, -5.7783261, -5.638244, -6.81852381, -0.112303, -6.5939179, -6.998531, -6.998531, -6.998531,  -6.998531},\
{-6.982719, -4.4460985, -6.6234959, -5.9851735, -5.5034848, -6.51932353, -5.8740176, -5.4055069, -5.2713295, -6.8212720, -3.3091108, -4.84308925, -5.5740125, -5.9946699, -6.2679505, -5.0294107, -6.0497532, -5.592927, -6.79066406, -6.890789, -0.1127953, -6.982719, -6.982719, -6.982719,  -6.982719},\
{-3.218876, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.218876, -3.21887582, -3.218876, -3.2188758, -3.218876, -3.218876, -3.218876,  -3.218876},\
{-3.218876, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.218876, -3.21887582, -3.218876, -3.2188758, -3.218876, -3.218876, -3.218876,  -3.218876},\
{-3.218876, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.218876, -3.21887582, -3.218876, -3.2188758, -3.218876, -3.218876, -3.218876,  -3.218876},\
{-3.218876, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.21887582, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.2188758, -3.218876, -3.21887582, -3.218876, -3.2188758, -3.218876, -3.218876, -3.218876,  -3.218876}};




double char_frequencies[NSTATE_AA]={2.55575050252e-7,0.0458355962374,0.0719062959636,0.068612700291,0.0976207240697,0.0297558363757,0.0424372147942,0.0599525397132,0.0720818760231,0.0134851619515,0.049724170627,0.0591395554783,0.107938288848,0.00386480590992,0.0354577157469,0.0294207774849,0.0300244457536,0.0595471976835,0.0244915014906,0.0612035795842,0.0375048718994,2.55575050252e-7,2.55575050252e-7,5.11150100505e-7,2.55575050252e-7};

/*
For nucleotides

	NUC		NUM
	---		---
	?		0
	T		1
	C		2
	A		3
	G		4
*/


double emiss_gap_nt[NSTATE_NT]={-2.995732274, -1.437587656, -1.437587656, -1.437587656, -1.437587656};

double emiss_match_nt[NSTATE_NT][NSTATE_NT]=\
{{-2.995732274, -2.995732274, -2.995732274, -2.995732274, -2.995732274},\
{-1.437587656, -0.105360516, -4.094344562, -4.094344562, -4.094344562},\
{-1.437587656, -4.094344562, -0.105360516, -4.094344562, -4.094344562},\
{-1.437587656, -4.094344562, -4.094344562, -0.105360516, -4.094344562},\
{-1.437587656, -4.094344562, -4.094344562, -4.094344562, -0.105360516}};


/*Structures*/

/*Stores all matrices - don't want to allocate them all the time*/
struct matrices {

	double ***m1_m;
	double ***m1_i;
	double ***m1_d;
	double ***m2_m;
	double ***m2_i;
	double ***m2_d;

	int *who_copy;

	int *maxpath_copy;
	int *maxpath_state;
	int *maxpath_pos;
	double *ppsum_match;
	double **ppsum_state;

	int maxl;
	double llk;

	double tb_divisor;

};



/*Function declarations*/

struct pars * get_pars(int argc, char *argv[]);
void kalign_fb(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);
struct data * add_null_term(struct data *my_data);
void classify_sequences(struct pars *my_pars, struct data *my_data);
struct matrices * allocate_matrices(struct data *my_data, struct pars *my_pars);
void deallocate_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices);
void print_max_acc_alignment(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);
void print_posterior_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);
void print_forward_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target, FILE *ofp);
void print_backward_matrices(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target, FILE *ofp);
void kalign_vt(struct data *my_data, struct pars *my_pars, struct matrices *my_matrices, int target);

#endif


